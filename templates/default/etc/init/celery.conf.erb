# This file is auto generated by chef
# Do no edit in place
description "Celery"
author "Rafael Durán Castañeda <rafadurancastaneda@gmail.com>"
start on runlevel [2345]
stop on runlevel [!2345]
#Send KILL after 20 seconds
kill timeout 20

script
exec su -c "<%= node[:celery][:command]%>celeryd_multi start <%= node[:celery][:workers] %> -l <%= node[:celery][:log_level] %> --logfile=<%= node[:celery][:log_dir] %>/celery%n.log -c <%= node[:celery][:concurrency] %><% if node[:celery][:events] -%> -E<% end -%><% if node[:celery][:beat] -%> -B<% end -%><% if node["celery"]["queues"] -%><% node["celery"]["queues"].each do |queue| -%> -Q<%= queue %> <% end -%><% end -%> --pool=<%= node[:celery][:pool] %> --pidfile=<%= node[:celery][:working_dir] %>/celery%n.pid" <%= node[:celery][:user] %>
end script

pre-stop script
exec su -c "<%= node[:celery][:command]%>celeryd_multi stop <%= node[:celery][:workers] %> -l <%= node[:celery][:log_level] %> --logfile=<%= node[:celery][:log_dir] %>/celery%n.log -c <%= node[:celery][:concurrency] %><% if node[:celery][:events] -%> -E<% end -%><% if node[:celery][:beat] -%> -B<% end -%><% if node["celery"]["queues"] -%><% node["celery"]["queues"].each do |queue| -%> -Q<%= queue %> <% end -%><% end -%> --pool=<%= node[:celery][:pool] %> --pidfile=<%= node[:celery][:working_dir] %>/celery%n.pid" <%= node[:celery][:user] %>
end script

respawn
